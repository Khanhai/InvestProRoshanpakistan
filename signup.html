<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up | InvestPro</title>
<link rel="icon" href="favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
<style>
:root{
  --primary:#FFA500;
  --bg:#fff;
  --card:#fff5e6;
  --text:#333;
}

/* Global */
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
body{background:var(--bg);color:var(--text);line-height:1.6;}

/* Page Loader */
#pageLoader{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(255,255,255,0.95);
  display:flex; justify-content:center; align-items:center;
  flex-direction:column;
  z-index:3000;
}
#pageLoader .spinner{
  border:5px solid #fff;
  border-top:5px solid var(--primary);
  border-radius:50%;
  width:60px; height:60px;
  animation:spin 1s linear infinite;
  margin-bottom:1rem;
}
#pageLoader .text{
  font-weight:600; color:var(--primary); font-size:1rem;
}

/* Header */
header{
  height:70px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 2rem;
  background:var(--bg);
  box-shadow:0 2px 10px rgba(0,0,0,.05);
}
.logo{
  font-size:1.5rem;
  font-weight:700;
  color:var(--primary);
  line-height:1;
  display:flex;
  flex-direction:column;
}
.logo small{font-size:.8rem;color:#666;line-height:1;margin-top:2px;}
.login-btn{
  background:var(--primary);
  color:#fff;
  padding:.55rem 1.3rem;
  border-radius:25px;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:.5rem;
  font-weight:600;
}
.login-btn i{font-size:16px;}

/* Sign Up Card */
.signup-container{
  max-width:450px;
  margin:3rem auto;
  padding:2rem;
  background:var(--card);
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  animation:fadeIn 1s ease;
}
.signup-container h2{
  text-align:center;
  color:var(--primary);
  margin-bottom:1.5rem;
}

/* Notification */
.notification{
  display:none;
  margin-bottom:1rem;
  padding:.8rem 1rem;
  border-radius:12px;
  font-weight:600;
  text-align:center;
  animation: slideIn 0.4s ease;
}

/* Inputs */
.form-group{margin-bottom:1rem;}
.form-group label{font-weight:600;display:block;margin-bottom:.3rem;}
.input-wrapper{position:relative;}
.input-wrapper i.left{
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  color:#999;
  font-size:14px;
}
.input-wrapper i.right{
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  color:#999;
  cursor:pointer;
}
.input-wrapper input{
  width:100%;
  padding:.85rem 2.8rem;
  border:1px solid #ccc;
  border-radius:14px;
  outline:none;
  font-size:.95rem;
  transition:.3s;
}
.input-wrapper input:focus{border-color:var(--primary);}
.optional{font-size:.8rem;color:#666;}

/* Button */
.signup-btn{
  width:100%;
  padding:.9rem;
  border:none;
  border-radius:30px;
  background:var(--primary);
  color:#fff;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:.6rem;
  cursor:pointer;
  transition:.3s;
}
.signup-btn:hover{
  transform:scale(1.04);
  box-shadow:0 6px 18px rgba(255,165,0,.4);
}
.signup-btn i{background:#fff;color:var(--primary);padding:.35rem;border-radius:50%;}

/* Loader in button */
.loader{
  width:18px;height:18px;
  border:3px solid #fff;
  border-top:3px solid rgba(255,255,255,.3);
  border-radius:50%;
  animation:spin 1s linear infinite;
  display:none;
}

/* Already login */
.already{text-align:center;margin-top:1rem;font-size:.9rem;}
.already a{color:var(--primary);font-weight:600;text-decoration:none;}

/* Footer */
footer{margin-top:2rem;background:var(--card);padding:1.5rem;text-align:center;font-size:.9rem;color:#555;}

/* Animations */
@keyframes spin{from{transform:rotate(0);}to{transform:rotate(360deg);}}
@keyframes slideIn{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@media(max-width:480px){.signup-container{margin:2rem 1rem;}}
</style>
</head>
<body>

<!-- Page Loader -->
<div id="pageLoader">
  <div class="spinner"></div>
  <div class="text">Loading...</div>
</div>

<header>
  <div class="logo">InvestPro<br><small>Roshan Pakistan</small></div>
  <a href="login.html" class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
</header>

<div class="signup-container animate__animated animate__fadeIn">
  <h2>Create Account</h2>
  <div class="notification" id="notification"></div>

  <div class="form-group">
    <label>Username</label>
    <div class="input-wrapper">
      <i class="fa-solid fa-user left"></i>
      <input type="text" id="username" placeholder="Enter username">
    </div>
  </div>

  <div class="form-group">
    <label>Email</label>
    <div class="input-wrapper">
      <i class="fa-solid fa-envelope left"></i>
      <input type="email" id="email" placeholder="Enter email">
    </div>
  </div>

  <div class="form-group">
    <label>Password</label>
    <div class="input-wrapper">
      <i class="fa-solid fa-lock left"></i>
      <input type="password" id="password" placeholder="Enter password">
      <i class="fa-solid fa-eye right" id="togglePass"></i>
    </div>
  </div>

  <div class="form-group">
    <label>Referral Code <span class="optional">(Optional)</span></label>
    <div class="input-wrapper">
      <i class="fa-solid fa-gift left"></i>
      <input type="text" id="referral" placeholder="Referral code">
    </div>
  </div>

  <button class="signup-btn" id="signupBtn">
    <i class="fa-solid fa-user-plus"></i> Sign Up
    <div class="loader" id="loader"></div>
  </button>

  <div class="already">
    Already have an account? <a href="login.html">Login</a>
  </div>
</div>

<footer>&copy; 2025 InvestPro. All rights reserved.</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC-VDLeGkVEHRx3bu1SUAwvv8t6Y6Fz0Dg",
  authDomain: "khanbaba-2d4e5.firebaseapp.com",
  databaseURL: "https://khanbaba-2d4e5-default-rtdb.firebaseio.com",
  projectId: "khanbaba-2d4e5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const signupBtn = document.getElementById('signupBtn');
const loader = document.getElementById('loader');
const notification = document.getElementById('notification');

// Hide loader when page fully loaded
window.addEventListener('load', ()=>{
  const pageLoader = document.getElementById('pageLoader');
  pageLoader.style.display='none';
});

// Notification helper
function showNotification(msg, type='info'){
  notification.innerText = msg;
  notification.style.display = 'block';
  notification.style.background = type==='error' ? '#ffd6d6' : '#ffebcc';
  notification.style.color = type==='error' ? '#cc0000' : '#cc6600';
  setTimeout(()=>notification.style.display='none',4000);
}

// Generate referral code
function generateCode(length=6){
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code='';for(let i=0;i<length;i++){code+=chars.charAt(Math.floor(Math.random()*chars.length));}return code;
}

// Toggle password visibility
document.getElementById('togglePass').onclick=()=>{
  const p=document.getElementById('password');
  p.type=p.type==='password'?'text':'password';
}

signupBtn.addEventListener('click', ()=>{
  const username=document.getElementById('username').value.trim();
  const email=document.getElementById('email').value.trim();
  const password=document.getElementById('password').value;
  const referral=document.getElementById('referral').value.trim();

  if(!username||!email||!password){
    showNotification('Please fill all required fields','error'); return;
  }

  loader.style.display='inline-block'; signupBtn.disabled=true;

  createUserWithEmailAndPassword(auth,email,password)
  .then(userCredential=>{
    const user=userCredential.user;
    updateProfile(user,{displayName:username}).then(()=>{
      const userRef = ref(db,'users/'+user.uid);
      const referralCode = generateCode();
      const userData = { email, displayName:username, balance:0, referralCode, refBalance:0, usedReferral:false };

      if(referral){
        get(ref(db,'users')).then(snap=>{
          const users = snap.val() || {};
          for(const uid in users){
            if(users[uid].referralCode===referral){userData.referredBy=uid; break;}
          }
          set(userRef,userData);
          showNotification('Account created successfully!','info');
          setTimeout(()=>window.location.href='dashboard.html',1500);
        });
      } else {
        set(userRef,userData);
        showNotification('Account created successfully!','info');
        setTimeout(()=>window.location.href='dashboard.html',1500);
      }
    });
  })
  .catch(error=>{
    loader.style.display='none';
    signupBtn.disabled=false;
    let msg='';
    switch(error.code){
      case 'auth/email-already-in-use': msg='Email is already registered'; break;
      case 'auth/invalid-email': msg='Please enter a valid email'; break;
      case 'auth/weak-password': msg='Password must be at least 6 characters'; break;
      default: msg='Something went wrong. Please try again';
    }
    showNotification(msg,'error');
  })
  .finally(()=>{
    loader.style.display='none';
    signupBtn.disabled=false;
  });
});
</script>
</body>
</html>